<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8" />

    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <header name = "Access-Control-Allow-Origin" value = "*" />


  <title>jQuery UI Autocomplete - Remote datasource</title>
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <!-- <link rel="stylesheet" href="/resources/demos/style.css"> -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

  <style>
  .ui-autocomplete-loading {
    /*background: white url("images/ui-anim_basic_16x16.gif") right center no-repeat;*/
  }
  .st-result {
    border-bottom: 1px solid #ddd;
    padding-bottom: 20px;
    margin-bottom: 10px;
}
  </style>
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
  $( function() {
    $( "#tabs" ).tabs({
      beforeLoad: function( event, ui ) {
        ui.jqXHR.fail(function() {
          ui.panel.html(
            "Couldn't load this tab. We'll try to fix this as soon as possible. " +
            "If this wouldn't be a demo." );
        });
      }
    });
  } );
  </script>

  <script>

// ================================================================================= //



// Calling searching API based on user query and return to full_search_result
function full_search(){
   
   $("#tabs").tabs({ active: 0 });
    user_query = $('#searchengine').val();
    gen_url  = 'http://13.232.131.155/search?domain=news-delaware&fl=url,title,og_description&q='+user_query+'&rows=22&start=10';
    $.ajax({type: 'GET',url:gen_url,success:full_search_result,error:function (xhr, ajaxOptions, thrownError){console.log("Post Error");}})

    $('#pno').val(1);
    document.getElementById("page-start").innerHTML = parseInt(1);
    document.getElementById("page-end").innerHTML = parseInt(10);
}

function getpaginationresult(pno){
    user_query = $('#searchengine').val();
    pno_start = pno+0;
    pno_end = 10;
    
    gen_url  = 'http://13.232.131.155/search?domain=news-delaware&fl=url,title,og_description&q='+user_query+'&rows='+pno_end+'&start='+pno_start+'';

    document.getElementById('pno').value = pno;
    $.ajax({type: 'GET',url:gen_url,success:full_search_result,error:function (xhr, ajaxOptions, thrownError){console.log("Post Error");}})

    document.getElementById("page-start").innerHTML = parseInt(pno_start)+1;
    document.getElementById("page-end").innerHTML = parseInt(pno_start)+10;
}

function full_search_result(search_response){
try{

if (typeof(search_response) == "object" ){

if (search_response.result == "success")
{

// search result success
total_result_count = search_response.response.numFound
search_responce = search_response.response.docs
/*console.log(total_result_count);
console.log(search_response);*/
document.getElementById("total-results").innerHTML = total_result_count;
document.getElementById("search-trem").innerHTML = user_query;


itemsPerPage =10;
pages = Math.ceil(total_result_count / itemsPerPage);

if (search_responce[0]) {
  if (search_responce[0].title) {
    $('#st-result-summary').css('display', 'block');
  }
}else{
  $('#st-result-summary').css('display', 'none');
}


var result_set = '';
$.each(search_responce, function(index, search_data){

    if (search_data.og_description) {
      desc = search_data.og_description;
    }else{
      desc = '';
    }
                  result_set += '<div class="st-result"><h3 class="title"><a href="'+search_data.url[0]+'" class="st-search-result-link">'+search_data.title[0]+' </a></h3><div class="st-metadata"><span class="st-snippet">'+desc+'</span></div></div><br>';

})

document.getElementById("total-results-set").innerHTML = result_set;

itemsPerPage =10;
pages = Math.ceil(total_result_count / itemsPerPage);

cpno = document.getElementById("pno").value;


var pagination = '';
var count = 0;
for (var i = 0; i < pages; i++) {
  pno = i+1;

 if (cpno) {
  
    if (cpno<4 || cpno==4) {

      if (pno == cpno ) {
          pagination +='<li class="page-item"><input class="page-link" type="button" value="' + pno + '" onClick="getpaginationresult(\'' + pno + '\')" style="background: #0056b3;color: #fff;"/> </li>'; 
          count = parseInt(count)+1;
       }else{
          pagination +='<li class="page-item"><input class="page-link" type="button" value="' + pno + '" onClick="getpaginationresult(\'' + pno + '\')" /></li>'; 
          count = parseInt(count)+1;
       }

    }else if(cpno>4){
      minpage = parseInt(cpno)-3;
      maxpage = parseInt(cpno)+3

      if (minpage<pno && maxpage>pno) {
      
        if (pno == cpno ) {
          pagination +='<li class="page-item"><input class="page-link" type="button" value="' + pno + '" onClick="getpaginationresult(\'' + pno + '\')" style="background: #0056b3;color: #fff;"/> </li>'; 
          count = parseInt(count)+1;
       }else{
          pagination +='<li class="page-item"><input class="page-link" type="button" value="' + pno + '" onClick="getpaginationresult(\'' + pno + '\')" /></li>'; 
          count = parseInt(count)+1;
       }

      }

    }

 }
  
  if (count == 6) { break; }
};
document.getElementById("cpagination").innerHTML = pagination;

}
else{
// search result failed
console.log("search result failed")
}
}else{console.log("search failed > not received json")}
//console.log(search_response)
}
catch(err){console.log("full_search_result> Error>"+err);}
}



// =============================================================================== //
  $( function() {

    $("#searchengine").autocomplete({
        source: function (request, response) {
            var matcher = new RegExp( $.ui.autocomplete.escapeRegex(request.term), "i" );
           user_query = $('#searchengine').val();
            $.ajax({
                url: "http://13.232.131.155/suggest?domain=news-delaware&q="+user_query,
                dataType: "json",
                success: function (data) { 

                    var docs = JSON.stringify(data.suggest.mySuggester);
 
                     var jsonData = JSON.parse(docs);
                     if (jsonData[user_query] != undefined) {
                        var sug_list = jsonData[user_query]['suggestions'];
                     }else{
                        var sug_list = '';
                     }
                     
                     response($.map(sug_list, function(value, key) {
   
                     return {

                      label : value.term,
                      value : value.term

                     }

                     }));                     

                }
            });
        },
       /* select: function( event, ui ) {
                      window.location.href = ui.item.value;
                    }*/
    });


  });
  </script>


</head>
<body>
  <div class="container">

      <br>

        <div class="input-group mb-3">
          <input  id="searchengine" name="query" type="text" class="form-control" placeholder="Search Here" aria-label="Recipient's username" aria-describedby="basic-addon2">
          <div class="input-group-append">
            <input type="submit" onclick="full_search()" class="btn btn-outline-secondary" type="button" placeholder="Search">
            
          </div>
        </div>


      <div class="row">
          <div class="col-md-12">

            <div id="tabs">
              <ul>
                <li><a href="#tabs-1">All results</a></li>
                <li><a href="pdfsearch.html">PDF</a></li>
                <li><a href="globalsearch.html">Global Search</a></li>
              </ul>
              <div id="tabs-1">

                <div id="results-container">
                       <br>
                       <div style="display: none" id="st-result-summary" class="alert alert-info">Showing <strong id="page-start">1</strong> - <strong id="page-end">10</strong> of <strong id="total-results">0</strong> results for "<strong id="search-trem">351</strong>"</div>
                       <br>
                       <div id="total-results-set">

                       </div>
                      


                       <br/> <br/>
                      
                       <!-- pagination -->
                      <nav aria-label="Page navigation example">
                        <ul class="pagination justify-content-center" id="cpagination">
                          
                        </ul>
                      </nav>
                      <input type="hidden" value="1" id="pno"> 


                    </div>


              </div>
            </div>




          </div>
      </div>


</div>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

</body>
</html>